# Kelly Pool 台球分牌助手实施计划

## 核心架构
*   **通信**: MQTT over WebSocket (使用 EMQX Public Broker)。
*   **架构**: 房主即主机 (Host-Client)。房主端负责洗牌、发牌、状态管理；普通玩家端只负责展示和接收指令。
*   **平台**: 纯静态网页 (HTML/JS/CSS)，适配移动端。

## 详细步骤

### 阶段一：基础建设与清理 (Setup)
1.  **清理旧文件**: 删除之前的“欢迎页”相关代码，保持仓库整洁。
2.  **引入依赖**: 下载 `mqtt.min.js` 到本地 `lib` 目录，确保国内访问稳定。
3.  **构建项目结构**:
    *   `index.html`: 入口页（选择身份：创建房间/加入房间）。
    *   `host.html`: 房主控制台（发牌、管理球状态、查看所有玩家状态）。
    *   `player.html`: 玩家视角（仅显示自己的手牌）。
    *   `js/mqtt-client.js`: 封装 MQTT 连接和消息收发逻辑。
    *   `js/game-logic.js`: 核心游戏逻辑（洗牌、状态同步）。

### 阶段二：核心功能开发 (Core Development)
1.  **连接模块**: 实现与 `broker.emqx.io` 的连接，生成随机且唯一的 Topic 前缀以隔离房间。
2.  **大厅逻辑**:
    *   房主创建房间 -> 生成房间号 (Topic)。
    *   玩家扫码/输入房间号 -> 订阅 Topic -> 发送“加入”消息。
3.  **房主控制台 (Host UI)**:
    *   显示已连接玩家列表。
    *   **发牌功能**: 算法实现 1-15 号球随机分配给 N 个玩家。
    *   **球状态管理**: 1-15 号球的按钮面板。点击某球 -> 广播“该球已打进”消息。
4.  **玩家界面 (Player UI)**:
    *   接收手牌数据并渲染（显示数字牌）。
    *   监听“球已打进”消息 -> 如果自己持有该球，自动标记为“结束/盖掉”状态（变灰或打叉）。

### 阶段三：UI/UX 优化 (Refinement)
1.  **移动端适配**: 大按钮、清晰的数字显示，防止误触。
2.  **状态同步反馈**: 掉线重连机制，确保游戏过程中网络波动不影响状态。
3.  **二维码生成**: 房主端生成加入链接的二维码。

### 阶段四：部署与交付 (Delivery)
1.  更新 `README.md` 说明游戏规则和使用方法。
2.  推送代码到 GitHub，确保 Pages 更新。
3.  提供最终访问链接。

## 关键数据结构设计 (MQTT Payload)
*   `type: 'JOIN'` (玩家 -> 房主)
*   `type: 'DEAL'` (房主 -> 玩家): `{ playerId: [1, 5, 12] }`
*   `type: 'BALL_POCKETED'` (房主 -> 所有): `{ ballNumber: 5 }` -> 客户端收到后，如果手牌有 5，则置灰。
